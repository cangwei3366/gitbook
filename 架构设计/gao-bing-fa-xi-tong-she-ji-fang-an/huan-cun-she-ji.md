# 缓存设计

一、背景&#x20;

二、原理

算法

FIFO/LFU/LRU/过期时间/随机

* FIFO：最先进入缓存的数据，在缓存空间不足时被清除，为了保证最新数据可用，保证实时性
* LFU(Least Frequently Used)：最近最不常用，基于访问次数，去除命中次数最少的元素，保证高频数据有效性
* LRU(Least Recently Used)：最近最少使用，基于访问时间，在被访问过的元素中去除最久未使用的元素，保证热点数据的有效性

评价指标

* 命中率 = 命中数 / （请求总数）

影响缓存命中率的因素：

1.业务场景和业务需求

缓存通常适合读多写少的业务场景。业务需求决定了实时性的要求，直接影响到过期时间和更新策略，实时性要求越低越适合缓存。

2.缓存的设计（策略和粒度）

通常情况下缓存的粒度越小，更新的效率越高，i比如一个集合和一条记录的更新效率肯定有差距。当数据发生变化时，直接更新缓存的值比移除缓存或者让缓存过期它的命中率更高，不过这个时候系统的复杂度过高。

3.缓存的容量

不同规模系统对不同缓存的架构要求也不一样，采用缓存的技术选型也是至关重要的，比如采用本地内置的应用缓存，就比较容易出现单机瓶颈。而采用分布式缓存就更加容易扩展。所以需要做好系统容量规划，系统是否可扩展。

三、实现

从缓存的存储介质可以分成内存、硬盘文件。

* 内存：将缓存存储于内存中是最快的选择，无需额外的I/O开销，但是内存的缺点是没有持久化落地物理磁盘，一旦应用异常break down而重新启动，数据很难或者无法复原。
* 硬盘：一般来说，很多缓存框架会结合使用内存和硬盘，在内存分配空间满了或是在异常的情况下，可以被动或主动的将内存空间数据持久化到硬盘中，达到释放空间或备份数据的目的。

本地缓存

分布式缓存

注解方式



四、问题

高并发缓存问题

